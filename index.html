<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b2b31" />
  <title>Stats • Apéro de Nuit 66</title>
  <meta name="description" content="Dashboard marketing • suivi des clics" />

  <!-- Social share -->
  <meta property="og:title" content="Stats • Apéro de Nuit 66" />
  <meta property="og:description" content="Dashboard marketing • suivi des clics" />
  <meta property="og:image" content="./assets/share-1200x630.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./assets/icon-192.png" />
  <link rel="apple-touch-icon" href="./assets/icon-192.png" />

  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="bg"></div>

  <div class="top">
    <div class="brand">
      <img class="logo" src="./assets/icon-192.png" alt="Logo" />
      <div>
        <div class="h1">Stats</div>
        <div class="sub">Dashboard marketing • suivi des clics</div>
      </div>
    </div>

    <div class="pills">
      <div class="pill"><span class="dot"></span>Cloudflare Workers</div>
      <div class="pill">D1 • <span id="dbName">stats_db</span></div>
      <div class="pill">API • <span id="apiHost">stats.aperos.net</span></div>
    </div>

    <div class="actions">
      <button class="btn" id="btnRefresh">Actualiser</button>
      <button class="btn ghost" id="btnCopyLinks">Copier mes liens</button>
      <button class="btn ghost" id="btnInstall" hidden>Ajouter à l’écran d’accueil</button>
    </div>

    <div class="statusRow">
      <div id="status" class="status warn">—</div>
      <div class="mini">
        <span>Auto</span>
        <label class="switch" title="Auto-refresh 30s">
          <input type="checkbox" id="autoToggle" />
          <span class="slider"></span>
        </label>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="card hero">
      <div class="heroTitle">APERO DE NUIT 66</div>
      <div class="heroText">
        <b>stat.aperos.net</b> • stats globales + détails (si endpoints disponibles)
      </div>
    </div>

    <div class="grid">
      <div class="card kpi">
        <div class="kpiLabel">Clics total</div>
        <div class="kpiValue" id="kpiTotal">—</div>
        <div class="kpiHint">Tous canaux confondus</div>
      </div>
      <div class="card kpi">
        <div class="kpiLabel">Aujourd’hui</div>
        <div class="kpiValue" id="kpiToday">—</div>
        <div class="kpiHint">Date locale</div>
      </div>
      <div class="card kpi">
        <div class="kpiLabel">Campagnes suivies</div>
        <div class="kpiValue" id="kpiCampaigns">—</div>
        <div class="kpiHint">apero • catalan • chance • jeux</div>
      </div>
    </div>

    <div class="grid2">
      <div class="card">
        <div class="cardHead">
          <div>
            <div class="cardTitle">Campagnes</div>
            <div class="sub">Tri : le plus cliqué en premier</div>
          </div>
          <span class="chip">Nom exact : apero / catalan / chance / jeux</span>
        </div>

        <div class="campaignCards">
          <div class="campaignCard">
            <div class="campTop">
              <div class="campName">Apéro</div>
              <span class="campPill">apero</span>
            </div>
            <div class="campValue" id="cApero">—</div>
            <div class="campExact">/go/apero?src=…</div>
          </div>

          <div class="campaignCard">
            <div class="campTop">
              <div class="campName">Catalan</div>
              <span class="campPill">catalan</span>
            </div>
            <div class="campValue" id="cCatalan">—</div>
            <div class="campExact">/go/catalan?src=…</div>
          </div>

          <div class="campaignCard">
            <div class="campTop">
              <div class="campName">Chance</div>
              <span class="campPill">chance</span>
            </div>
            <div class="campValue" id="cChance">—</div>
            <div class="campExact">/go/chance?src=…</div>
          </div>

          <div class="campaignCard">
            <div class="campTop">
              <div class="campName">Jeux</div>
              <span class="campPill">jeux</span>
            </div>
            <div class="campValue" id="cJeux">—</div>
            <div class="campExact">/go/jeux?src=…</div>
          </div>
        </div>

        <div class="tableWrap">
          <table class="table">
            <thead>
              <tr>
                <th>Campagne</th>
                <th class="right">Clics</th>
                <th class="hideSm">Tracking</th>
                <th class="hideSm">Destination</th>
              </tr>
            </thead>
            <tbody id="tbodyCampaign"></tbody>
          </table>
        </div>
        <div class="hint">Tip : utilise des sources propres (ex : <b>facebook</b>, <b>sms</b>, <b>qr</b>, <b>direct</b>)</div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div>
            <div class="cardTitle">Origines (source)</div>
            <div class="sub">⚠️ s’affiche seulement si l’API renvoie bySource</div>
          </div>
          <span class="chip">direct / facebook / sms / qr…</span>
        </div>
        <div class="tableWrap">
          <table class="table small">
            <thead><tr><th>Source</th><th class="right">Clics</th></tr></thead>
            <tbody id="tbodySource"></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div>
            <div class="cardTitle">Appareils</div>
            <div class="sub">mobile / desktop</div>
          </div>
          <span class="chip">Device</span>
        </div>
        <div class="tableWrap">
          <table class="table small">
            <thead><tr><th>Appareil</th><th class="right">Clics</th></tr></thead>
            <tbody id="tbodyDevice"></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div>
            <div class="cardTitle">Systèmes</div>
            <div class="sub">Android / iOS / Windows / macOS…</div>
          </div>
          <span class="chip">OS</span>
        </div>
        <div class="tableWrap">
          <table class="table small">
            <thead><tr><th>OS</th><th class="right">Clics</th></tr></thead>
            <tbody id="tbodyOS"></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div>
            <div class="cardTitle">Navigateurs</div>
            <div class="sub">Chrome / Safari / Edge…</div>
          </div>
          <span class="chip">Browser</span>
        </div>
        <div class="tableWrap">
          <table class="table small">
            <thead><tr><th>Navigateur</th><th class="right">Clics</th></tr></thead>
            <tbody id="tbodyBrowser"></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div>
            <div class="cardTitle">Pays</div>
            <div class="sub">ISO country (CF)</div>
          </div>
          <span class="chip">Country</span>
        </div>
        <div class="tableWrap">
          <table class="table small">
            <thead><tr><th>Pays</th><th class="right">Clics</th></tr></thead>
            <tbody id="tbodyCountry"></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div>
            <div class="cardTitle">Clics par heure (aujourd’hui)</div>
            <div class="sub">⚠️ s’affiche seulement si l’API renvoie hourly</div>
          </div>
          <span class="chip">Heure locale</span>
        </div>
        <div class="tableWrap">
          <table class="table small">
            <thead><tr><th>Heure</th><th class="right">Clics</th></tr></thead>
            <tbody id="tbodyHourly"></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div>
            <div class="cardTitle">Derniers clics</div>
            <div class="sub">⚠️ s’affiche seulement si l’API renvoie last</div>
          </div>
          <span class="chip">Les 50 derniers</span>
        </div>
        <div class="tableWrap">
          <table class="table small">
            <thead>
              <tr>
                <th>Date</th>
                <th>Campagne</th>
                <th>Source</th>
                <th>Pays</th>
                <th class="hideSm">Device</th>
                <th class="hideSm">OS</th>
                <th class="hideSm">Browser</th>
              </tr>
            </thead>
            <tbody id="tbodyLast"></tbody>
          </table>
        </div>
      </div>

      <div class="foot">
        <span id="buildInfo">PWA prête</span>
        <span class="sep">•</span>
        <button class="linkBtn" id="btnHardReload">Forcer MAJ</button>
        <span class="sep">•</span>
        <a href="https://stats.aperos.net/api/health" target="_blank" rel="noopener">Health</a>
        <span class="sep">•</span>
        <a href="https://stats.aperos.net/api/stats" target="_blank" rel="noopener">Stats</a>
      </div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>
