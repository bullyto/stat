<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#061425" />
  <title>Stats • ADN66</title>

  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icon-192.png" />
  <link rel="apple-touch-icon" href="./icon-192.png" />

  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">ADN66</div>
      <div class="meta">
        <div class="title">PWA Statistiques</div>
        <div class="sub">API : <span id="apiHost">stats.aperos.net</span></div>
      </div>
    </div>

    <div class="actions">
      <button id="btnRefresh" class="btn">Rafraîchir</button>
      <label class="toggle">
        <input id="autoToggle" type="checkbox" />
        <span>Auto</span>
      </label>
      <button id="btnCopyLinks" class="btn btnGhost">Copier les liens</button>
      <button id="btnHardReload" class="btn btnGhost">Hard reload</button>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <div class="cardHead">
        <h2>Liens de tracking (référence)</h2>
        <p class="muted">Copie/colle ces URLs dans tes boutons. Format regroupé comme demandé.</p>
      </div>
      <pre id="trackingLinks" class="codebox"></pre>
    </section>

    <section class="grid2">
      <section class="card">
        <div class="cardHead">
          <h2>Age Gate — Compteurs</h2>
          <p class="muted">Basé sur <code>*.age.accept</code> / <code>*.age.refuse</code> (table <code>events</code>).</p>
        </div>

        <div class="kpiGrid">
          <div class="kpi">
            <div class="kpiLabel">Apéro de Nuit — Accepté</div>
            <div class="kpiValue" id="ageAperoAccept">—</div>
          </div>
          <div class="kpi">
            <div class="kpiLabel">Apéro de Nuit — Refusé</div>
            <div class="kpiValue" id="ageAperoRefuse">—</div>
          </div>
          <div class="kpi">
            <div class="kpiLabel">Apéro Catalan — Accepté</div>
            <div class="kpiValue" id="ageCatalanAccept">—</div>
          </div>
          <div class="kpi">
            <div class="kpiLabel">Apéro Catalan — Refusé</div>
            <div class="kpiValue" id="ageCatalanRefuse">—</div>
          </div>
        </div>

        <div class="divider"></div>

        <h3 class="h3">Barres — campagnes (/go)</h3>
        <div id="barsCampaign" class="bars"></div>

        <h3 class="h3">Barres — marques (events)</h3>
        <div id="barsBrand" class="bars"></div>

        <p class="muted small">
          Couleurs : Catalan = jaune • Apéro de nuit = bleu • Hibair Drink = violet • Roue = rouge.
        </p>
      </section>

      <section class="card">
        <div class="cardHead">
          <h2>Derniers 50 (clicks + events)</h2>
          <p class="muted">Inclut OS et navigateur (Android/iOS/Windows… + Chrome/Safari/Firefox…).</p>
        </div>

        <div class="miniGrid">
          <div class="mini">
            <div class="miniLabel">OS (top)</div>
            <div id="last50OS" class="miniValue">—</div>
          </div>
          <div class="mini">
            <div class="miniLabel">Navigateurs (top)</div>
            <div id="last50Browser" class="miniValue">—</div>
          </div>
        </div>

        <div class="tableWrap">
          <table class="table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Clé</th>
                <th>Src</th>
                <th>Pays</th>
                <th>Device</th>
                <th>OS</th>
                <th>Navigateur</th>
                <th>Cible</th>
              </tr>
            </thead>
            <tbody id="tbodyLast50"></tbody>
          </table>
        </div>
      </section>
    </section>

    <section class="card">
      <div class="cardHead">
        <h2>Installer la PWA</h2>
        <p class="muted">Optionnel : bouton d’installation (Android/Chrome). Sur iPhone : “Partager → Sur l’écran d’accueil”.</p>
      </div>
      <div class="actionsRow">
        <button id="btnInstall" class="btn">Installer</button>
        <span id="installHint" class="muted"></span>
      </div>
    </section>

    <footer class="foot muted small">
      <span>ADN66 • Stats</span>
    </footer>
  </main>

  <script src="./app.js"></script>
</body>
</html>
